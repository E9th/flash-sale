<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flash Sale Monitor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .apple-gradient {
            background: radial-gradient(circle at center, #ffffff 0%, #f5f5f7 100%);
        }
    </style>
</head>
<body class="apple-gradient text-gray-900 flex flex-col items-center justify-center min-h-screen p-6 antialiased">

    <nav class="absolute top-0 w-full p-6 flex justify-between items-center max-w-6xl mx-auto">
        <h1 class="text-xl font-medium tracking-tight text-gray-800">Flash Sale Monitor</h1>
        <div id="status" class="text-xs font-medium px-3 py-1 rounded-full bg-gray-200 text-gray-500">Connecting...</div>
    </nav>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 w-full max-w-5xl items-center">
        <!-- Product Section -->
        <div class="flex flex-col items-center text-center space-y-6">
            <div class="relative group">
                <img src="https://images.unsplash.com/photo-1695048133142-1a20484d2569?auto=format&fit=crop&q=80&w=600" 
                     class="w-64 md:w-80 h-auto object-contain drop-shadow-2xl transition-transform duration-500 hover:scale-105 rounded-3xl">
            </div>
            
            <div class="space-y-2">
                <h2 class="text-4xl md:text-5xl font-semibold tracking-tight text-gray-900">iPhone 15 Pro</h2>
                <p class="text-xl text-gray-500 font-light">Titanium. So strong. So light. So Pro.</p>
            </div>

            <div class="mt-8 p-6 bg-white/50 backdrop-blur-xl rounded-2xl border border-white/60 shadow-sm w-full max-w-xs">
                <span class="text-xs font-semibold uppercase tracking-wider text-gray-400">Available Stock</span>
                <div id="stock-display" class="text-6xl font-medium tracking-tighter text-gray-900 mt-2 transition-colors duration-300">100</div>
            </div>
        </div>

        <!-- Analytics Section -->
        <div class="bg-white p-8 rounded-3xl shadow-sm border border-gray-100 flex flex-col justify-between h-[400px]">
            <div class="mb-6">
                <h3 class="text-lg font-medium text-gray-900">Live Activity</h3>
                <p class="text-sm text-gray-500">Real-time inventory tracking</p>
            </div>
            <div class="flex-grow w-full relative">
                <canvas id="orderChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        const stockDisplay = document.getElementById('stock-display');
        const statusDisplay = document.getElementById('status');
        let currentStock = 100;

        // --- Chart.js Setup ---
        Chart.defaults.font.family = "'Inter', sans-serif";
        Chart.defaults.color = '#9ca3af';
        
        const ctx = document.getElementById('orderChart').getContext('2d');
        const chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: Array(20).fill(''), 
                datasets: [{
                    label: 'Stock Level',
                    data: Array(20).fill(100),
                    borderColor: '#0071e3', // Apple Blue
                    backgroundColor: (context) => {
                        const ctx = context.chart.ctx;
                        const gradient = ctx.createLinearGradient(0, 0, 0, 400);
                        gradient.addColorStop(0, 'rgba(0, 113, 227, 0.2)');
                        gradient.addColorStop(1, 'rgba(0, 113, 227, 0)');
                        return gradient;
                    },
                    borderWidth: 2,
                    pointRadius: 0,
                    pointHoverRadius: 4,
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                animation: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: 'rgba(0,0,0,0.8)',
                        padding: 12,
                        cornerRadius: 8,
                        titleFont: { size: 11 },
                        bodyFont: { size: 12 }
                    }
                },
                scales: {
                    x: { grid: { display: false }, border: { display: false } },
                    y: { 
                        beginAtZero: true, 
                        max: 120,
                        grid: { color: '#f3f4f6', borderDash: [4, 4] },
                        border: { display: false }
                    }
                }
            }
        });

        // --- WebSocket Setup ---
        const ws = new WebSocket("ws://" + window.location.host + "/ws");

        ws.onopen = () => {
            statusDisplay.innerText = "Live Connected";
            statusDisplay.className = "text-xs font-medium px-3 py-1 rounded-full bg-green-100 text-green-700 animate-pulse";
        };

        ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            
            // 1. Update Number
            currentStock = data.stock;
            stockDisplay.innerText = currentStock;

            // Minimalist color changes
            if (currentStock === 0) {
                stockDisplay.className = "text-6xl font-medium tracking-tighter text-red-600 mt-2";
                stockDisplay.innerText = "Sold Out";
            } else if (currentStock < 20) {
                stockDisplay.className = "text-6xl font-medium tracking-tighter text-orange-500 mt-2";
            } else {
                stockDisplay.className = "text-6xl font-medium tracking-tighter text-gray-900 mt-2";
            }

            // 2. Update Graph
            const newLabel = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            chart.data.labels.push(newLabel);
            chart.data.labels.shift(); 
            
            chart.data.datasets[0].data.push(currentStock);
            chart.data.datasets[0].data.shift(); 
            
            chart.update();
        };

        ws.onclose = () => {
            statusDisplay.innerText = "Disconnected";
            statusDisplay.className = "text-xs font-medium px-3 py-1 rounded-full bg-red-100 text-red-600";
        };
    </script>
</body>
</html>